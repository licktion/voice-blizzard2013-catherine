buildscript {
    repositories {
        mavenLocal()
        jcenter()
        maven {
            url 'https://oss.jfrog.org/oss-release-local/'
        }
    }
    dependencies {
        classpath group: 'de.dfki.mary', name: 'gradle-marytts-voicebuilding-plugin', version: '0.5.3-SNAPSHOT'
    }
}

apply plugin: 'de.dfki.mary.voicebuilding'

repositories {
    flatDir {
        dir '../blizzard2013-data'
    }
}

configurations {
    rawdata
}

dependencies {
    rawdata group: 'lessac', name: 'BlackBeauty', version: 'blizzard2013', ext: 'zip'
}

task extractWav(type: Copy) {
    from configurations.rawdata
    into "$buildDir/wav"
    filesMatching '*.zip', { zipFileDetails ->
        logger.info "Unpacking $zipFileDetails.file"
        copy {
            from zipTree(zipFileDetails.file)
            into destinationDir
            eachFile { logger.lifecycle it.name }
        }
        zipFileDetails.exclude()
    }
}

task copyPitch(type: Copy) {
    from(project(':blizzard2013-data').projectDir) {
        include 'pm/*.Pitch'
    }
    into buildDir
}

task copyLabels(type: Copy) {
    from(project(':blizzard2013-data').projectDir) {
        include 'lab/*.lab'
    }
    into buildDir
}

task extractTextFiles {
    def txtFile = file("src/raw/resources/all.txt")
    def destDir = file("$buildDir/text")
    outputs.dir destDir
    inputs.files txtFile
    doFirst {
        destDir.mkdirs()
    }
    doLast {
        txtFile.eachLine {
            def (basename, content) = it.split(":", 2)
            file("$destDir/${basename}.txt").text = content.trim()
        }
    }
}

task prepareVoicebuilding {
    dependsOn copyWav, copyPitch, copyLabels, extractTextFiles
}
